#!/bin/bash

# exit on error
set -eu

# curl -L blackarch.org/strap.sh | sh
# curl -L larbs.xyz/larbs.sh     | sh
# curl -L nixos.org/nix/install  | sh && source "$HOME/.nix-profile/etc/profile.d/nix.sh"
# ( which nix-env >/dev/nul ) || yes | sh <(curl -L https://nixos.org/nix/install) --daemon && $SUDO nix-daemon &

# ( true  || true  ) && echo yes || echo no # -> yes
# ( true  || false ) && echo yes || echo no # -> yes
# ( false || true  ) && echo yes || echo no # -> yes
# ( false || false ) && echo yes || echo no # -> no

# ( ! true  && ! true  ) && echo yes || echo no # -> no
# ( ! true  && ! false ) && echo yes || echo no # -> no
# ( ! false && ! true  ) && echo yes || echo no # -> no
# ( ! false && ! false ) && echo yes || echo no # -> yes

# Detect root/sudo:
# ( [ "$(id -u)" != 0 ] && [ ! -e "/bin/sudo" ] ) || ( echo "$(tput -T ansi setaf 3) run as root or install sudo( and run without sudo ) $(tput -T ansi sgr0)" && exit 1 )
  ( [ "$(id -u)" == 0 ] || [   -e "/bin/sudo" ] ) || ( echo "$(tput -T ansi setaf 3) run as root or install sudo( and run without sudo ) $(tput -T ansi sgr0)" && exit 1 )
    [ "$(id -u)" != 0 ] &&  export SUDO="sudo"    || export SUDO="" # if non-root use sudo

echo "$(tput -T ansi setaf 3) Installing Packages... $(tput -T ansi sgr0)"

# Pacman:
$SUDO sed -i 's/#Color/Color/'                         /etc/pacman.conf
$SUDO sed -i 's/#ParallelDownloads/ParallelDownloads/' /etc/pacman.conf
$SUDO sed -i '/ParallelDownloads/a\ILoveCandy'         /etc/pacman.conf
$SUDO pacman -Sy --noconfirm base-devel git glibc ||
{
  $SUDO pacman-key --init
  $SUDO pacman-key --populate
  $SUDO pacman -Sy  --noconfirm archlinux-keyring
  $SUDO pacman -Syu --noconfirm base-devel git
}

# Neovim:
$SUDO curl -Lo /usr/local/bin/nvim https://github.com/neovim/neovim/releases/download/v0.9.1/nvim.appimage && $SUDO chmod +x /usr/local/bin/nvim

# AUR:
$SUDO curl -L https://github.com/Jguer/yay/releases/download/v12.1.2/yay_12.1.2_x86_64.tar.gz | $SUDO tar -xzf- --strip-components=1 --directory="/usr/local/bin" "yay_12.1.2_x86_64/yay"
# $SUDO rm -rf /var/cache/private/yay /var/cache/yay

# Browser:
# yes | yay -S --noconfirm google-chrome

# GUI dependencies: (yay as root requires systemd)
[ ! -e /.dockerenv ] && {

  # root doesn't support yay multi-install
  # yes | yay -S --noconfirm --mflags "--skippgpcheck" ttf-unifont &&
  yes | yay -S --noconfirm cht.sh-git                            &&
  yes | yay -S --noconfirm dragon-drop                           &&
  yes | yay -S --noconfirm gtk-theme-arc-gruvbox-git             &&
  yes | yay -S --noconfirm htop-vim                              &&
  yes | yay -S --noconfirm pywal-16-colors                       &&
  yes | yay -S --noconfirm siji-git                              &&
  yes | yay -S --noconfirm snapper-rollback                      &&
  yes | yay -S --noconfirm touchcursor-linux-git                 &&
  yes | yay -S --noconfirm zsh-fast-syntax-highlighting          &&
  yes | $SUDO pacman -S --noconfirm \
  broadcom-wl \
  bspwm \
  btrfs-progs \
  cronie \
  dosfstools \
  dmenu \
  dunst \
  exfat-utils \
  festival-us \
  gnome-keyring \
  kitty \
  libnotify \
  light \
  man-db \
  mediainfo \
  moreutils \
  mpc \
  mpd \
  mpv-mpris \
  ncmpcpp \
  network-manager-applet \
  ntfs-3g \
  perl-file-mimeinfo \
  picom \
  playerctl \
  polybar \
  redshift \
  rofi \
  rofimoji \
  snapper \
  sxhkd \
  sxiv \
  unclutter \
  wezterm \
  xcape \
  xdo \
  xdotool \
  xorg-server \
  xorg-xinit \
  xorg-xmodmap \
  xorg-xset \
  xorg-xsetroot \
  xf86-input-synaptics \
  zathura-pdf-mupdf \
  && true | yay -Scc || ( printf "$(tput -T ansi setaf 1) Installing GUI deps failed! $(tput -T ansi sgr0)" && exit 1 )
}

# Non GUI dependencies:
$SUDO pacman -S --noconfirm \
bat \
fzf \
ghostscript \
imagemagick \
lazygit \
lf \
libsixel \
mpv \
pipewire-pulse \
poppler \
ripgrep \
starship \
stow \
unzip \
xclip \
zsh-autosuggestions \
&& true | pacman -Scc || ( printf "$(tput -T ansi setaf 1) Installing Non GUI deps failed! $(tput -T ansi sgr0)" && exit 1 )

echo "$(tput -T ansi setaf 3) Installing Packages... Done! $(tput -T ansi sgr0)"

# Optional:
# 8188eu-aircrack-dkms-git
# abook
# acpi
# aircrack-ng
# alacritty
# alttab-git
# arandr
# arandr
# atool
# base
# bashtop
# bc
# bcm43142-firmware
# bedstead-fonts-powerline
# binfmt-qemu-static
# blackarch-keyring
# blackarch-mirrorlist
# blueman
# brave-bin
# bsp-layout
# bsptab-git
# cdrtools
# cheat-git
# cheat-sh
# chromium
# command-not-found
# cool-retro-term
# devour
# dialog
# djvulibre
# dmenu
# docker
# dwm
# dwmblocks
# efibootmgr
# ffmpeg
# ffmpegthumbnailer
# figlet
# fuse2
# fzf-tab-bin-git
# gimp
# grub
# grub-btrfs
# gvim
# hashcat
# highlight
# htop-vim-git
# i3-gaps
# i3-vim-syntax-git
# i3status
# intel-ucode
# lazygit
# lf-sixel-git
# libreoffice
# libsixel
# libxft-bgra
# linux
# linux-firmware
# linux-headers
# linux-wifi-hotspot
# lunarvim-git
# mlocate
# mlterm
# moreutils
# mpv-full
# mtools
# mupdf-tools
# mutt-wizard-git
# ncdu
# neofetch
# neovim-catppuccin-git
# neovim-material-git
# neovim-moonlight-git
# neovim-nebulous-git
# neovim-nordic-git
# nerd-fonts-cascadia-code
# nerd-fonts-hack
# networkmanager
# newsboat
# ngrok
# nmap
# nodejs-how2
# notcurses
# novnc
# obs-studio
# os-prober
# pamixer
# paru-bin
# pavucontrol
# pcmanfm-gtk3
# pfetch
# poppler
# pulseaudio-alsa
# pulsemixer
# python-ueberzug-git
# pywal
# qemu-user-static
# ranger-sixel
# rxvt-unicode
# scrcpy
# sgtk-menu
# simple-mtpfs
# sixel-tmux-git
# skippy-xd-git
# spaceship-prompt
# spotify
# spotify-adblock-git
# spotify-adkiller-git
# sshfs
# stpv-git
# sxhkhm-git
# task-spooler
# terminus-font
# termplay
# tigervnc
# tmate
# transmission-cli
# transmission-gtk
# trash-cli
# tsserver
# ttf-hack
# ttf-unifont
# ueberzug
# unrar
# urxvt-perls
# vim-aquarium
# vim-dracula
# vimv-git
# visual-studio-code-bin
# vscodium-bin
# vscodium-bin-marketplace
# wmctrl
# x2x-git
# xcompmgr
# xdg-utils
# xf86-video-amdgpu
# xorg-fonts-misc
# xorg-xdpyinfo
# xorg-xprop
# xorg-xwininfo
# xwallpaper
# youtube-dl
# ytfzf
# zip
# zsh-completions
# zsh-vi-mode
