#!/bin/bash

# exit on error
set -eu

# curl -L blackarch.org/strap.sh | sh
# curl -L larbs.xyz/larbs.sh     | sh
# curl -L nixos.org/nix/install  | sh && source "$HOME/.nix-profile/etc/profile.d/nix.sh"
# ( which nix-env >/dev/nul ) || yes | sh <(curl -L https://nixos.org/nix/install) --daemon

# ( true  || true  ) && echo yes || echo no # -> yes
# ( true  || false ) && echo yes || echo no # -> yes
# ( false || true  ) && echo yes || echo no # -> yes
# ( false || false ) && echo yes || echo no # -> no

# ( ! true  && ! true  ) && echo yes || echo no # -> no
# ( ! true  && ! false ) && echo yes || echo no # -> no
# ( ! false && ! true  ) && echo yes || echo no # -> no
# ( ! false && ! false ) && echo yes || echo no # -> yes

# Detect root/sudo:
# ( [ "$(id -u)" != 0 ] && [ ! -e "/bin/sudo" ] ) || ( echo "$(tput -T ansi setaf 3) run as root or install sudo( and run without sudo ) $(tput -T ansi sgr0)" && exit 1 )
  ( [ "$(id -u)" == 0 ] || [   -e "/bin/sudo" ] ) || ( echo "$(tput -T ansi setaf 3) run as root or install sudo( and run without sudo ) $(tput -T ansi sgr0)" && exit 1 )
    [ "$(id -u)" != 0 ] &&  export SUDO="sudo"    || export SUDO="" # if non-root use sudo

echo "$(tput -T ansi setaf 3) Installing Packages... $(tput -T ansi sgr0)"

# Pacman:
$SUDO sed -i 's/#Color/Color/'                         /etc/pacman.conf
$SUDO sed -i 's/#ParallelDownloads/ParallelDownloads/' /etc/pacman.conf
$SUDO sed -i '/ParallelDownloads/a\ILoveCandy'         /etc/pacman.conf
$SUDO pacman -Sy --noconfirm --needed base-devel lazygit ||
{
  $SUDO pacman-key --init
  $SUDO pacman-key --populate
  $SUDO pacman -Sy  --noconfirm archlinux-keyring
  $SUDO pacman -Syu --noconfirm base-devel glibc lazygit
}

# Neovim:
$SUDO curl -Lo /usr/local/bin/nvim https://github.com/neovim/neovim/releases/download/v0.9.5/nvim.appimage && $SUDO chmod +x /usr/local/bin/nvim

# AUR:
$SUDO curl -L https://github.com/Jguer/yay/releases/download/v12.1.2/yay_12.1.2_x86_64.tar.gz | $SUDO tar -xzf- --strip-components=1 --directory="/usr/local/bin" "yay_12.1.2_x86_64/yay"

# pacman -S --noconfirm --needed gtk3 wget xdg-user-dirs
# curl -L https://raw.githubusercontent.com/ivan-hc/AM-Application-Manager/main/APP-MANAGER -o ~/.local/bin/appman && chmod +x ~/.local/bin/appman && mkdir -p ~/.config/appman && echo ".local/appimage" > ~/.config/appman/appman-config
# [ -e ~/.local/appimage ]  && echo "skipping appman install ..." || ~/.local/bin/appman install \
#   code \
#   google-chrome \
#   wezterm

# GUI dependencies: (yay as root requires systemd)
[ ! -e /.dockerenv ] && {

  # root doesn't support yay multi-install
  # yes | yay -S --noconfirm --mflags "--skippgpcheck" ttf-unifont &&
  # yes | yay -S --noconfirm htop-vim                              &&
  # yes | yay -S --noconfirm gtk-theme-arc-gruvbox-git             &&
  # yes | yay -S --noconfirm pywal-16-colors                       &&
  # yes | yay -S --noconfirm google-chrome                         &&
  # yes | yay -S --noconfirm visual-studio-code-bin                &&
  yes | yay -S --noconfirm bspwm-git                             &&
  yes | yay -S --noconfirm cht.sh-git                            &&
  yes | yay -S --noconfirm dragon-drop                           &&
  yes | yay -S --noconfirm kanata-bin                            &&
  yes | yay -S --noconfirm light                                 &&
  yes | yay -S --noconfirm siji-git                              &&
  yes | yay -S --noconfirm zsh-fast-syntax-highlighting          &&
  yes | $SUDO pacman -S --noconfirm --needed \
  broadcom-wl \
  btrfs-progs \
  cronie \
  dosfstools \
  dmenu \
  dunst \
  exa \
  exfat-utils \
  festival-us \
  gnome-keyring \
  kitty \
  libnotify \
  man-db \
  moreutils \
  mpc \
  mpd \
  mpv-mpris \
  ncmpcpp \
  network-manager-applet \
  noto-fonts \
  noto-fonts-emoji \
  ntfs-3g \
  perl-file-mimeinfo \
  picom \
  playerctl \
  polybar \
  redshift \
  rofi \
  rofimoji \
  snapper \
  sxhkd \
  sxiv \
  ttf-3270-nerd \
  ttf-firacode-nerd \
  ttf-font-awesome \
  unclutter \
  wezterm \
  xdo \
  xdotool \
  xorg-server \
  xorg-xinit \
  xorg-xsetroot \
  xorg-xwininfo \
  xwallpaper \
  xf86-input-synaptics \
  zathura-pdf-poppler \
  zram-generator \
  && true | yay -Scc || ( printf "$(tput -T ansi setaf 1) Installing GUI deps failed! $(tput -T ansi sgr0)" && exit 1 )
}

# Non GUI dependencies:
$SUDO pacman -S --noconfirm --needed \
  bat \
  fzf \
  ghostscript \
  imagemagick \
  lf \
  libsixel \
  mpv \
  pipewire-pulse \
  poppler \
  ripgrep \
  starship \
  stow \
  unzip \
  xclip \
  zsh-autosuggestions \
  && true | $SUDO pacman -Scc || ( printf "$(tput -T ansi setaf 1) Installing Non GUI deps failed! $(tput -T ansi sgr0)" && exit 1 )

echo "$(tput -T ansi setaf 3) Installing Packages... Done! $(tput -T ansi sgr0)"

# Optional:
# 8188eu-aircrack-dkms-git
# acpi
# aircrack-ng
# alttab-git
# arandr
# bedstead-fonts-powerline
# binfmt-qemu-static
# blackarch-keyring
# blackarch-mirrorlist
# blueman
# brave-bin
# bsp-layout
# bsptab-git
# cheat-git
# cheat-sh
# command-not-found
# cool-retro-term
# devour
# dmenu
# docker
# dwm
# dwmblocks
# efibootmgr
# ffmpeg
# ffmpegthumbnailer
# figlet
# fuse2
# fzf-tab-bin-git
# gimp
# grub
# hashcat
# htop-vim-git
# intel-ucode
# libreoffice
# libsixel
# linux
# linux-firmware
# linux-headers
# lunarvim-git
# mediainfo
# mtools
# mupdf-tools
# mutt-wizard-git
# ncdu
# neofetch
# neovim-catppuccin-git
# neovim-material-git
# neovim-moonlight-git
# neovim-nebulous-git
# neovim-nordic-git
# networkmanager
# newsboat
# ngrok
# nmap
# nodejs-how2
# notcurses
# noto-fonts-cjk
# novnc
# obs-studio
# os-prober
# otf-latinmodern-math
# paru-bin
# pavucontrol
# pcmanfm-gtk3
# polkit-gnome
# pulsemixer
# pywal
# qemu-user-static
# scrcpy
# sgtk-menu
# simple-mtpfs
# skippy-xd-git
# sshfs
# stpv-git
# tigervnc
# tmate
# transmission-cli
# transmission-gtk
# tsserver
# ttf-cascadia-code-nerd
# ttf-terminus-nerd
# ueberzugpp
# unrar
# vimv-git
# visual-studio-code-bin
# vscodium-bin
# vscodium-bin-marketplace
# wmctrl
# x2x-git
# xcompmgr
# xdg-utils
# xf86-video-amdgpu
# xorg-fonts-misc
# xorg-xdpyinfo
# xorg-xhost
# xorg-xprop
# xorg-xset
# xwallpaper
# youtube-dl
# ytfzf
# zip
# zsh-completions
# zsh-vi-mode
