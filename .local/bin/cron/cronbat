#!/bin/env zsh

# cat /sys/class/power_supply/BAT0/{status,capacity} | {
# 	read -d "\n" status capacity
#   [ "$status" = "Charging" ] && exit
#   [ "$capacity" -lt 50 ] && notify-send -u critical "$capacity% $status"
# }

# If running as root use "sudo -i" though audio doesn't work
# date +%T | awk -F ':' '($1 >= 1 && $2 <= 59)' | xargs -I_ [ -z _ ] || (echo "23:59 hours ðŸ›Œ lights out" | tee >(festival --tts) >(xargs -I_ sudo -i notify-send -u critical _ ) )

countdown() {
  NID=0
  for i in {$1..0..1}
    do
      NID=$(notify-send -p -r $NID "${i}" )
      sleep 1
    done
}

# DON'T EVEN DARE TO COMMENT THIS CODE OUT
date +%T | awk -F ':' '($1 >= 23 && $2 == 50)' | xargs -I_ [ -z _ ] || (echo "23:50 hours ðŸ›Œ lights out" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 23 && $2 == 40)' | xargs -I_ [ -z _ ] || (echo "23:40 hours ðŸ›Œ still redeyes? " | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 23 && $2 == 30)' | xargs -I_ [ -z _ ] || (echo "23:30 hours ðŸ›Œ follow your own rules " | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 23 && $2 == 20)' | xargs -I_ [ -z _ ] || (echo "23:20 hours ðŸ›Œ less energy more migraine" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 23 && $2 == 10)' | xargs -I_ [ -z _ ] || (echo "23:10 hours ðŸ›Œ waking late++" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 23 && $2 == 00)' | xargs -I_ [ -z _ ] || (echo "23:00 hours ðŸ›Œ follow the rules" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 22 && $2 == 50)' | xargs -I_ [ -z _ ] || (echo "22:50 hours ðŸ›Œ sleep boy health is first, glasses?" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 22 && $2 == 40)' | xargs -I_ [ -z _ ] || (echo "22:40 hours ðŸ›Œ go bed, listen podcats" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 22 && $2 == 30)' | xargs -I_ [ -z _ ] || (echo "22:30 hours ðŸ›Œ work smart than harder" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
# date +%T | awk -F ':' '($1 >= 22 && $2 == 30)' | xargs -I_ [ -z _ ] || (echo "22:20 hours ðŸ›Œ use your time wisely" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
# date +%T | awk -F ':' '($1 >= 22 && $2 == 10)' | xargs -I_ [ -z _ ] || (echo "22:10 hours ðŸ›Œ 4AM rule, feeling untired, study math, bysnappy" | tee >(festival --tts)  && countdown 1800 && sudo poweroff)
# date +%T | awk -F ':' '($1 >= 22 && $2 == 00)' | xargs -I_ [ -z _ ] || (echo "22:00 hours ðŸ›Œ wake up before the enemy, challenge yourself" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
# date +%T | awk -F ':' '($1 >= 21 && $2 == 50)' | xargs -I_ [ -z _ ] || (echo "21:50 hours ðŸ›Œ feeling slow, low cognition" | tee >(festival --tts) && countdown 1800 && sudo poweroff)
date +%T | awk -F ':' '($1 >= 21 && $2 == 40) {exit 1}' || (festival --tts <<<"21:40 hours ðŸ’¤ sleeping late equals sleepy next day" && notify-send -u low "21:40 hours ðŸ’¤")
date +%T | awk -F ':' '($1 >= 21 && $2 ~".0") {print $1":"$2}' | festival --tts
date +%T | awk -F ':' '($1 ~ "." && $2 == 00) {print $1":"$2}' | festival --tts
cat /sys/class/power_supply/BAT0/capacity | awk ' $1 >= 98 {system("festival --tts <<<complete-charge") }'
cat /sys/class/power_supply/BAT0/status | awk '$1 == "Charging" {exit 1}' &&
cat /sys/class/power_supply/BAT0/capacity | awk '$1 <= 15 {system("festival --tts <<<"$1"-percent") } ; $1 == 5 {system("notify-send -u critical " $1 "% discharging\n") }'

